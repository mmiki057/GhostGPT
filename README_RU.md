# Phantom

Приложение для общения с ChatGPT через голос и скриншоты с невидимым в записях экрана окном.

## Новые возможности

- Форматированный текст - ответы разделяются на абзацы для лучшей читаемости
- Остановка генерации - красная кнопка "Stop" для прерывания ответа
- Свободная прокрутка - можно листать историю во время генерации ответа
- Отображение скриншотов - скриншоты показываются прямо в чате
- Toggle запись голоса - первое нажатие начинает, второе останавливает и отправляет

## Быстрый старт

### Режим разработки

```bash
./run-phantom.sh
```

### Сборка приложения

```bash
npm run tauri:build
```

Готовое приложение: `src-tauri/target/release/bundle/macos/Phantom.app`

### Запуск собранного приложения

```bash
./start-production.sh
```

### Остановка

```bash
./stop-production.sh
```

## Первоначальная настройка

1. **Установите зависимости**:
```bash
npm install
python3 -m venv venv
source venv/bin/activate
pip install -r backend/requirements.txt
```

2. **Настройте OpenAI API ключ**:
```bash
echo "OPENAI_API_KEY=sk-ваш-ключ" > .env
```

3. **Запустите**:
```bash
./run-phantom.sh
```

## Горячие клавиши

- **Cmd+Shift+Space** - показать/скрыть окно приложения
- **Cmd+Enter** - начать/остановить запись голоса (toggle режим)
- **Enter** - отправить текстовое сообщение
- **Shift+Enter** - перенос строки в тексте
- **Кнопка "Stop"** - остановить генерацию ответа

## Использование

1. **Текстовый чат**:
   - Напишите сообщение в поле ввода
   - Нажмите Enter или кнопку "Send Text"

2. **Голосовой ввод** (новый режим toggle):
   - Первое нажатие Cmd+Enter или кнопки "Voice" - **начинает** запись
   - Статус меняется на "Recording..."
   - Говорите в микрофон
   - Второе нажатие Cmd+Enter или кнопки "Stop Recording" - **останавливает** запись
   - Сообщение автоматически распознается и отправится GPT

3. **Анализ скриншота**:
   - Нажмите кнопку "Screenshot"
   - Приложение захватит экран и отправит его GPT для анализа
   - Скриншот будет виден в чате

4. **Остановка ответа**:
   - Во время генерации появится красная кнопка "Stop"
   - Нажмите её, чтобы прервать генерацию

## Архитектура

```
┌─────────────────┐
│  Tauri + React  │  ← Графический интерфейс
│   (Frontend)    │     (прозрачное окно)
└────────┬────────┘
         │ HTTP
         │
┌────────▼────────┐
│  Flask Server   │  ← Backend на Python
│   (Backend)     │     - Запись аудио
│                 │     - Распознавание речи (Whisper)
│                 │     - Захват скриншотов
│                 │     - API OpenAI
└─────────────────┘
```

## Полная сборка для распространения

Для создания полностью автономного приложения:

```bash
# 1. Соберите Tauri приложение
npm run tauri:build

# 2. Создайте DMG (опционально)
npm run tauri:build -- --bundles dmg
```

Файлы будут в:
- **Приложение**: `src-tauri/target/release/bundle/macos/Phantom.app`
- **DMG**: `src-tauri/target/release/bundle/dmg/Phantom_*.dmg`

**Важно**: Backend (Python сервер) нужно запускать отдельно. Используйте `start-production.sh` для автоматического запуска обоих компонентов.

## Разработка

### Структура проекта

```
Phantom/
├── src/                      # React компоненты
│   ├── App.tsx              # Главный компонент
│   ├── components/
│   │   └── MessageList.tsx  # Компонент чата
│   └── styles/
│       └── App.css          # Стили
├── src-tauri/               # Tauri приложение
│   ├── src/main.rs         # Rust код
│   └── tauri.conf.json     # Конфигурация
├── backend/                 # Python сервер
│   ├── server.py           # Flask API
│   └── requirements.txt    # Зависимости
└── .env                     # Переменные окружения
```

### Основные файлы

- **App.tsx** - логика приложения, обработка сообщений, streaming
- **MessageList.tsx** - отображение чата, форматирование текста, скриншоты
- **server.py** - API для аудио, скриншотов и OpenAI
- **tauri.conf.json** - настройки окна (прозрачность, горячие клавиши)

## Решение проблем

### Ошибка "OPENAI_API_KEY not set"
```bash
cat .env  # Проверьте содержимое
echo "OPENAI_API_KEY=sk-ваш-ключ" > .env
```

### Ошибка "Port 5001 already in use"
```bash
lsof -i :5001
kill -9 <PID>
```

### Приложение не появляется
- Проверьте, что backend запущен: `curl http://localhost:5001/health`
- Проверьте логи: `cat /tmp/phantom-backend.log`

### Не работает микрофон
Разрешите доступ к микрофону:
System Preferences → Security & Privacy → Microphone → включите Terminal/Phantom

### Не работают скриншоты
Разрешите доступ к записи экрана:
System Preferences → Security & Privacy → Screen Recording → включите Terminal/Phantom

## Дополнительная документация

- [QUICKSTART.md](QUICKSTART.md) - краткое руководство

## Кастомизация

### Изменить размер окна
Отредактируйте `src-tauri/tauri.conf.json`:
```json
{
  "app": {
    "windows": [{
      "width": 400,
      "height": 500
    }]
  }
}
```

### Изменить стили
Отредактируйте `src/styles/App.css`:
```css
:root {
  --bg-overlay: rgba(20, 20, 25, 0.92);  /* Фон окна */
  --accent: #6366f1;                      /* Цвет кнопок */
  /* ... */
}
```

### Изменить горячую клавишу
Отредактируйте `src-tauri/src/main.rs` и зарегистрируйте новую комбинацию.

## Лицензия

MIT
